<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" href="styles/button.css">
</head>
<body>
    <div id="header-bar">TICKET LIVE TICKETS</div>

    <div id="button-container">
        <a href="tickets.html" class="admin-button">Tickets</a>
        <a href="concerts.html" class="admin-button">Concerts</a>
        <a href="users.html" class="admin-button">Users</a>
    </div>

    <table id="tickets-table">
        <thead>
            <tr>
                <th>ID</th>
                <th>Catagory</th>
                <th>Concert ID</th>
                <th>Seat</th>
                <th>Status</th>
                <th>Description ID</th>
                <th>Catagory ID</th>
                <th>Edit</th>
            </tr>
        </thead>
        <tbody id="tickets-body">
            <!-- čia bus dinamiškai įkelti duomenys -->
        </tbody>

    </table>

    <div style="text-align: center; margin-bottom: 20px;">
        <button onclick="addTicket()" class="action-button edit-button">Add new</button>
    </div>

    <script>
        function loadTickets() {
            fetch('http://localhost:8080/ticket')  // pakeisk adresą jei reikia
                .then(response => response.json())
                .then(tickets => {
                    const tbody = document.getElementById('tickets-body');
                    tbody.innerHTML = '';  // išvalom esamą turinį
                    
                    tickets.forEach(ticket => {
                        const tr = document.createElement('tr');

                        tr.innerHTML = `
                            <td>${ticket.id}</td>
                            <td>${ticket.category || ''}</td>
                            <td>${ticket.concert_id || ''}</td>
                            <td>${ticket.seat_number || ''}</td>
                            <td>${ticket.status || ''}</td>
                            <td>${ticket.ticket_description_id || ''}</td>
                            <td>${ticket.ticket_category_id || ''}</td>
                            <td>
                                <button class="action-button edit-button" onclick="editTicket(this)">Edit</button>
                                <button class="action-button delete-button" onclick="deleteTicket(this, ${ticket.id})">Delete</button>
                            </td>
                        `;
                        tbody.appendChild(tr);
                    });
                })
                .catch(error => {
                    console.error('Klaida užkraunant ticketus:', error);
                });
        }

        // Kviečiame iš karto po puslapio užkrovimo
        window.onload = loadTickets;

        // Pakeisk deleteTicket funkciją, kad pašalintų ir iš backend
        function deleteTicket(button, ticketId) {
            if (confirm("Are you sure you want to delete?")) {
                fetch(`http://localhost:8080/ticket/${ticketId}`, { method: 'DELETE' })
                    .then(response => {
                        if (response.ok) {
                            const row = button.closest("tr");
                            row.remove();
                        } else {
                            alert('Nepavyko ištrinti ticket');
                        }
                    })
                    .catch(error => alert('Klaida tryniant ticket: ' + error));
            }
        }
    </script>

    <a class="logout-button" href="index.html">Log out</a>
</body>
</html>
