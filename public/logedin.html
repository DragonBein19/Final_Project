<!DOCTYPE html>
<html>
<head>
    <link href='https://fonts.googleapis.com/css?family=Afacad' rel='stylesheet'>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link rel="stylesheet" href="styles/logedin.css">
</head>
<body>
    <img src="/konc2.jpeg" alt="Fonas" id="background-image" />

    <div id="header-bar">
        <div id="left-section">
            <button class="toggle-btn" onclick="toggleSidebar()">☰</button>
            <button id="filter-button" class="toggle-btn">▼</button>
        </div>

        <a href="index.html" id="center-title">TICKET LIVE</a>

        <div id="right-icon">
            <input type="text" placeholder="Search..." id="search-input">
            <button id="search-button">⌕</button>
            <i class="fa-solid fa-cart-shopping" onclick="toggleCartSidebar()" style="cursor:pointer;"></i>
        </div>
    </div>

    <div id="sidebar">
        <a class="menu-btn" href="tickethistory.html">Ticket history</a>
        <a class="menu-btn" href="profiledetails.html">Profile details</a>
    </div>

    <div id="cart-sidebar">
        <p style="color:white;">Your Cart is empty.</p>
        <p style="color:white;">Total: $0.00</p>
    </div>

    <div id="full-page-window">
        <div id="header-bar-white">
            <div id="menu-close">✕</div>
            <div id="center-title-white">TICKET LIVE</div>
        </div>

        <div id="content-area">
            <div id="concert-filter-box">
                <select id="artist-filter">
                    <option value="">All artists</option>
                </select>
                <select id="location-filter">
                    <option value="">All locations</option>
                </select>
                <select id="genre-filter">
                    <option value="">All genres</option>
                </select>
                <select id="date-filter">
                    <option value="">All Dates</option>
                    <option value="asc">Upcoming concert</option>
                    <option value="desc">Most distant</option>
                </select>
            </div>
            <div id="concert-list-container"></div>
        </div>

        <div id="bottom-box-white">
            <p>Live music starts here. Discover the best live concerts, from chart-topping headliners to rising local talent.</p>
        </div>

        <div id="footer-bar-white">©2025 GABRIELĖ GERMANTĖ NIKITA INEDA PI23A</div>
    </div>

    <div id="footer-bar">©2025 GABRIELĖ GERMANTĖ NIKITA INEDA PI23A</div>
    <a href="index.html" id="logout-button">Log out</a>

    <div id="concert-section">
        <a id="concert-title">Upcoming Concerts</a>
        <div id="concert-container">
            <div id="concert-list">
                <script>
                    fetch('http://localhost:8080/concerts')
                    .then(response => response.json())
                    .then(concerts => {
                        const list = document.getElementById('concert-list');

                        concerts.forEach(concert => {
                            const concertDiv = document.createElement('div');
                            concertDiv.className = 'concert';
                            concertDiv.innerHTML = `
                                <h2>${concert.title}</h2>
                                <p><strong>Date:</strong> ${concert.dateTime}</p>
                                <p><strong>Status:</strong> ${concert.status}</p>
                                <p><strong>Description:</strong> ${concert.description}</p>
                                <p><strong>Tickets:</strong> ${concert.tickets}</p>
                                <p><strong>Venue:</strong> ${concert.venue?.name || "Unknown"}</p>
                            `;
                            list.appendChild(concertDiv);
                        });
                    })
                    .catch(error => console.error('Error loading concerts:', error));
                </script>
            </div>
        </div>
    </div>

    <style>
        #concert-section {
            width: 90%;
            max-width: 900px;
            margin: 0 auto;
            padding-top: 120px;
        }

        #concert-title {
            display: block;
            text-align: center;
            font-size: 22pt;
            color: white;
            margin-bottom: 10px;
        }

        #concert-container {
            max-height: 775px;
            margin-top: 10px;
            overflow-y: auto;
            padding: 15px 20px;
            background: rgba(0, 0, 0, 0);
            border-radius: 15px;
            border: 1px solid rgba(0, 0, 0, 0);
            box-sizing: border-box;
        }

        #concert-container::-webkit-scrollbar {
            width: 0px;
        }

        #concert-container::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
        }

        #concert-container::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 10px;
        }

        #concert-container::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.6);
        }

        #concert-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .concert {
            background: rgba(42, 42, 42, 0.4);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 15px;
            font-size: 12pt;
            color: white;
            box-sizing: border-box;
        }
    </style>

    <script>
        function toggleSidebar() {
            const sidebar = document.getElementById("sidebar");
            sidebar.classList.toggle("active");
        }

        function toggleCartSidebar() {
            const cartSidebar = document.getElementById("cart-sidebar");
            cartSidebar.classList.toggle("active");
        }

        const filterBtn = document.getElementById("filter-button");
        const fullWindow = document.getElementById("full-page-window");
        const closeBtn = document.getElementById("menu-close");

        filterBtn.addEventListener("click", () => {
            fullWindow.style.display = "flex";
        });

        closeBtn.addEventListener("click", () => {
            fullWindow.style.display = "none";
        });


        const concerts = [
            { artist: "Justine Timberlake", location: "Kaunas", genre: "Pop", date: "2025-06-06" },
            { artist: "BA.", location: "Vilnius", genre: "Rock", date: "2025-06-10" },
            { artist: "Free finga", location: "Vilnius", genre: "R&B", date: "2025-07-01" },
            { artist: "OG Version", location: "Klaipėda", genre: "Rap", date: "2025-06-20" },
        ];

        window.onload = function () {
            const artistSet = new Set();
            const locationSet = new Set();
            const genreSet = new Set();

            concerts.forEach(c => {
                artistSet.add(c.artist);
                locationSet.add(c.location);
                genreSet.add(c.genre);
            });

            fillSelect("artist-filter", [...artistSet]);
            fillSelect("location-filter", [...locationSet]);
            fillSelect("genre-filter", [...genreSet]);

            renderConcerts(concerts);
        };

        function fillSelect(id, options) {
            const select = document.getElementById(id);
            options.forEach(opt => {
                const option = document.createElement("option");
                option.value = opt;
                option.textContent = opt;
                select.appendChild(option);
            });
        }

        document.querySelectorAll("#concert-filter-box select").forEach(select => {
            select.addEventListener("change", applyFilters);
        });

        function applyFilters() {
            const artist = document.getElementById("artist-filter").value;
            const location = document.getElementById("location-filter").value;
            const genre = document.getElementById("genre-filter").value;
            const dateOrder = document.getElementById("date-filter").value;

            let filtered = concerts.filter(c => {
                return (!artist || c.artist === artist) &&
                       (!location || c.location === location) &&
                       (!genre || c.genre === genre);
            });

            if (dateOrder === "asc") {
                filtered.sort((a, b) => new Date(a.date) - new Date(b.date));
            } else if (dateOrder === "desc") {
                filtered.sort((a, b) => new Date(b.date) - new Date(a.date));
            }

            renderConcerts(filtered);
        }

        function renderConcerts(list) {
            const container = document.getElementById("concert-list-container");
            container.innerHTML = "";

            if (list.length === 0) {
                container.innerHTML = "<p>No results found.</p>";
                return;
            }

            list.forEach(c => {
                const div = document.createElement("div");
                div.innerHTML = `
                    <strong>${c.artist}</strong> – ${c.genre}<br>
                    Location: ${c.location}<br>
                    Date: ${new Date(c.date).toLocaleDateString()}
                `;
                container.appendChild(div);
            });
        }
    </script>
</body>
</html>
