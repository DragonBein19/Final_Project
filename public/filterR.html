<!DOCTYPE html>
<html>
    <head>
        <link href="https://fonts.googleapis.com/css?family=Afacad" rel="stylesheet">
        <link rel="stylesheet" href="styles/filter.css">
        <title>Filter</title>
    </head>
    
    <body>
        <img src="/konc2.jpeg" alt="Fonas" id="background-image" />
        <div id="header-bar">
            <a id="menu-close" href="logedin.html">✕</a>
            <div id="center-title-white">TICKET LIVE</div>
        </div>

        <div id="content-area">
            <div id="concert-filter-box">
                <select id="artist-filter">
                    <option value="">All artists</option>
                </select>
                <select id="date-filter">
                    <option value="">All Dates</option>
                    <option value="asc">Upcoming concert</option>
                    <option value="desc">Most distant</option>
                </select>
            </div>

            <div id="concert-list-container"></div>
        </div>

        <div id="bottom-box">
            <p>Live music starts here. Discover the best live concerts, from chart-topping headliners to rising local talent.</p>
        </div>

        <div id="footer-bar">©2025 GABRIELĖ GERMANTĖ NIKITA INEDA PI23A</div>

        <script>
            let concerts = []; 

            async function loadConcerts() {
                try {
                const response = await fetch('http://localhost:8080/concerts');
                if (!response.ok) {
                    throw new Error('Failed to fetch concerts');
                }
                concerts = await response.json();
                populateArtistFilter(); 
                filterConcerts(); 
                } catch (error) {
                console.error('Error loading concerts:', error);
                document.getElementById('concert-list-container').innerHTML = '<p>Failed to load concerts.</p>';
                }
            }

            function populateArtistFilter() {
                const artistFilter = document.getElementById('artist-filter');
                const artists = [...new Set(concerts.map(c => c['Concert name']))]; 

                artists.forEach(artist => {
                    const option = document.createElement('option');
                    option.value = artist;
                    option.textContent = artist;
                    artistFilter.appendChild(option);
                });
            }

            function filterConcerts() {
                const artistFilterValue = document.getElementById('artist-filter').value;
                const dateFilterValue = document.getElementById('date-filter').value;

                let filteredConcerts = concerts;

                if (artistFilterValue) {
                filteredConcerts = filteredConcerts.filter(c => c['Concert name'] === artistFilterValue);
                }

                if (dateFilterValue === 'asc') {
                filteredConcerts.sort((a, b) => new Date(a['Concert date']) - new Date(b['Concert date']));
                } else if (dateFilterValue === 'desc') {
                filteredConcerts.sort((a, b) => new Date(b['Concert date']) - new Date(a['Concert date']));
                }

                displayConcerts(filteredConcerts);
            }

            function displayConcerts(concerts) {
                const container = document.getElementById('concert-list-container');
                container.innerHTML = "";

                if (!concerts.length) {
                container.innerHTML = '<p>No concerts found.</p>';
                return;
                }

                concerts.forEach(c => {
                const div = document.createElement("div");
                div.classList.add("concert-card");

                const date = new Date(c['Concert date']);

                div.innerHTML = `
                    <strong>${c['Concert name']}</strong><br>
                    <em>${date.toLocaleDateString()}</em><br>
                    <p>${c.description}</p>
                    <p>Tickets sold: ${c['Ticket Sold'] || '0'}</p>
                `;

                container.appendChild(div);
                });
            }

            document.getElementById('artist-filter').addEventListener('change', filterConcerts);
            document.getElementById('date-filter').addEventListener('change', filterConcerts);

            window.onload = loadConcerts;
        </script>

    </body>
</html>