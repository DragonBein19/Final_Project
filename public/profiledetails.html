<!DOCTYPE html>
<html>
    <head>
        <link href='https://fonts.googleapis.com/css?family=Afacad' rel='stylesheet'>
        <link rel="stylesheet" href="styles/profiledetails.css">
    </head>

    <body>
        <img src="/konc2.jpeg" alt="Fonas" id="background-image" />

        <div id="header-bar" id="center-title">TICKET LIVE</div>

        <div id="footer-bar">©2025 GABRIELĖ GERMANTĖ NIKITA INEDA PI23A</div>

        <div id="dark-box">
            <h2>Profile details</h2>
            <div id="user-info">
                <p><span class="label">Name:</span> <span class="value" id="name"></span></p>
                <p><span class="label">Surname:</span> <span class="value" id="surname"></span></p>
                <p><span class="label">Email:</span> <span class="value" id="email"></span></p>
                <p><span class="label">Phone number:</span> <span class="value" id="phone"></span></p>
                <p><span class="label">Registration date:</span> <span class="value" id="registrationDate"></span></p>
                </div>
            <a id="DoneButton" href="logedin.html">Done</a>
            <a id="EditButton">Edit</a>
            <script>
                let userId = null;

                fetch('http://localhost:8080/users')
                    .then(response => {
                        if (!response.ok) {
                            throw new Error("Error: " + response.statusText);
                        }
                        return response.json();
                    })
                    .then(user => {
                        const user = users[0];

                        userId = user.id; 

                        document.getElementById("name").textContent = user.name;
                        document.getElementById("surname").textContent = user.surname;
                        document.getElementById("email").textContent = user.email;
                        document.getElementById("phone").textContent = user.phone;
                        document.getElementById("registrationDate").textContent = new Date(user.registrationDate).toLocaleString();
                    })
                    .catch(error => {
                        document.getElementById("user-info").innerHTML = "<p>Error while loading data.</p>";
                        console.error(error);
                    });

                document.getElementById("EditButton").addEventListener("click", function () {
                    const fields = ["name", "surname", "email", "phone"];

                    fields.forEach(field => {
                        const span = document.getElementById(field);
                        const currentValue = span.textContent;
                        const input = document.createElement("input");
                        input.type = "text";
                        input.value = currentValue;
                        input.id = field + "-input";
                        span.replaceWith(input);
                    });

                    this.textContent = "Save";
                    this.id = "SaveButton";

                    document.getElementById("SaveButton").addEventListener("click", function () {
                        const updatedUser = {
                            name: document.getElementById("name-input").value,
                            surname: document.getElementById("surname-input").value,
                            email: document.getElementById("email-input").value,
                            phone: document.getElementById("phone-input").value
                        };

                        fetch('http://localhost:8080/users/edit', {
                            method: 'PUT',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify(updatedUser)
                        })
                        .then(response => {
                            if (!response.ok) {
                                throw new Error("Failed to update");
                            }
                            return response.text();
                        })
                        .then(() => location.reload())
                        .catch(error => alert("Update failed: " + error));
                    }, { once: true });
                });
            </script>
        </div>
    </body>
</html>